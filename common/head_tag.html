<script type="text/discourse-plugin" version="0.1">
    api.modifyClass('controller:topic', {
       actions:{
           replyToPost(post, skipWarning = false) {
                let bumpedAt = this.get('model.bumped_at');
                let now = moment();
                let diff = now.diff(bumpedAt);
                let d = moment.duration(settings.death_timer);

                if((diff >= d) && !skipWarning){
                    // TODO: i18n this
                    let confirmationMessage = "The last post in this thread was {0}. Are you sure you want to bump this thread?".format(bumpedAt.fromNow());
                    bootbox.confirm(confirmationMessage, I18n.t("no_value"), I18n.t("yes_value"), result => {
                        if (result) {
                          this.send('replyToPost', post, true);
                        }
                    });
                } else {
                    return this._super(post);
                }
           }
       }
    });
</script>
